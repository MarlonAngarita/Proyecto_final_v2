<section class="contenedor-desafios-usuario">
  <!-- Encabezado -->
  <div class="encabezado-logo">
    <h2>Misiones disponibles</h2>
    <img src="/assets/Logo.png" alt="Logo" class="logo-proyecto" />
    <button class="btn-volver-desafios-usuario" (click)="volverAlDashboard()">â Volver</button>
  </div>

  <!-- EstadÃ­sticas del usuario -->
  <div class="estadisticas-usuario" *ngIf="!cargandoDesafios && !errorCarga">
    <div class="stat-card">
      <div class="stat-numero">{{ getNumeroDesafiosDisponibles() }}</div>
      <div class="stat-label">Disponibles</div>
    </div>
    <div class="stat-card">
      <div class="stat-numero">{{ getNumeroDesafiosCompletados() }}</div>
      <div class="stat-label">Completados</div>
    </div>
    <div class="stat-card">
      <div class="stat-numero">{{ getPuntosTotales() }}</div>
      <div class="stat-label">Puntos ganados</div>
    </div>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="cargandoDesafios" class="loading-indicator">
    <div class="spinner"></div>
    <p>Cargando desafÃ­os disponibles...</p>
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="errorCarga" class="error-message">
    <p>{{ errorCarga }}</p>
    <button (click)="recargarDesafios()" class="btn-retry">ğŸ”„ Reintentar</button>
  </div>

  <!-- Grid de desafÃ­os -->
  <div class="grid-desafios" *ngIf="!cargandoDesafios && desafios.length > 0">
    <div 
      class="tarjeta-desafio" 
      *ngFor="let desafio of desafios"
      [class.completado]="estaCompletado(desafio.id || 0)"
    >
      <!-- Estado completado -->
      <div class="badge-completado" *ngIf="estaCompletado(desafio.id || 0)">
        âœ… Completado
      </div>

      <!-- Contenido del desafÃ­o -->
      <div class="desafio-header">
        <h3>{{ desafio.titulo || desafio.nombre_desafio }}</h3>
        <span 
          class="nivel-badge" 
          [style.background-color]="getColorDificultad(desafio.nivel || desafio.dificultad)"
        >
          {{ desafio.nivel || desafio.dificultad }}
        </span>
      </div>

      <p class="descripcion">{{ desafio.descripcion }}</p>

      <div class="desafio-footer">
        <div class="recompensa">
          <span class="puntos">ğŸ† {{ desafio.puntos || desafio.recompensa }} puntos</span>
        </div>

        <button 
          class="btn-comenzar"
          (click)="comenzarDesafio(desafio)"
          [disabled]="estaCompletado(desafio.id || 0) || cargando"
        >
          {{ estaCompletado(desafio.id || 0) ? 'âœ… Completado' : 'ğŸš€ Comenzar' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay desafÃ­os -->
  <div *ngIf="!cargandoDesafios && !errorCarga && desafios.length === 0" class="sin-desafios">
    <h3>ğŸ¯ No hay desafÃ­os disponibles</h3>
    <p>Los profesores aÃºn no han creado desafÃ­os.</p>
    <p>Â¡Vuelve mÃ¡s tarde para nuevos desafÃ­os!</p>
  </div>

  <!-- Modal del desafÃ­o -->
  <div class="modal" *ngIf="modalDesafioActivo">
    <div class="modal-contenido">
      <button class="modal-cerrar" (click)="cerrarModal()">âœ–</button>
      
      <div class="modal-header">
        <h2>{{ desafioActual?.titulo || desafioActual?.nombre_desafio }}</h2>
        <span 
          class="nivel-badge" 
          [style.background-color]="getColorDificultad(desafioActual?.nivel || desafioActual?.dificultad || '')"
        >
          {{ desafioActual?.nivel || desafioActual?.dificultad }}
        </span>
      </div>

      <div class="modal-body">
        <p><strong>DescripciÃ³n:</strong></p>
        <p>{{ desafioActual?.descripcion }}</p>
        
        <div class="recompensa-info">
          <p><strong>Recompensa:</strong> ğŸ† {{ desafioActual?.puntos || desafioActual?.recompensa }} puntos</p>
        </div>

        <div class="instrucciones">
          <p><strong>Instrucciones:</strong></p>
          <ul>
            <li>Lee cuidadosamente la descripciÃ³n del desafÃ­o</li>
            <li>Aplica tus conocimientos para resolverlo</li>
            <li>Una vez completado, obtendrÃ¡s los puntos de recompensa</li>
            <li>Â¡Tu racha de aprendizaje tambiÃ©n aumentarÃ¡!</li>
          </ul>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          class="btn-completar" 
          (click)="completarDesafio()"
          [disabled]="cargando"
        >
          {{ cargando ? 'Completando...' : 'âœ… Marcar como completado' }}
        </button>
        <button class="btn-cancelar" (click)="cerrarModal()" [disabled]="cargando">
          âŒ Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de completado -->
  <div class="modal" *ngIf="modalCompletadoActivo">
    <div class="modal-contenido exito">
      <button class="modal-cerrar" (click)="cerrarModalCompletado()">âœ–</button>
      
      <div class="celebracion">
        <div class="icono-exito">ğŸ‰</div>
        <h2>Â¡Felicitaciones!</h2>
        <p>Has completado el desafÃ­o exitosamente</p>
        
        <div class="recompensa-obtenida">
          <p>ğŸ† <strong>+{{ desafioActual?.puntos || desafioActual?.recompensa }} puntos ganados</strong></p>
          <p>ğŸ”¥ <strong>Â¡Tu racha continÃºa!</strong></p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-continuar" (click)="cerrarModalCompletado()">
          ğŸš€ Â¡Continuar!
        </button>
      </div>
    </div>
  </div>

  <!-- Submodal con mensaje de confirmaciÃ³n -->
  <div class="submodal" *ngIf="mensajeConfirmacion">
    <div class="submodal-contenido">
      <p>{{ mensajeConfirmacion }}</p>
    </div>
  </div>
</section>
