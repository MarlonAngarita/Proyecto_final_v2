<section class="contenedor-desafios">
  <!-- TÃ­tulo de la secciÃ³n de creaciÃ³n -->
  <div class="encabezado-logo">
    <h2>Crear nuevo desafÃ­o</h2>
    <img src="/assets/Logo.png" alt="Logo" class="logo-proyecto" />
    <button class="btn-volver-desafios" (click)="volverAlDashboard()">â Volver</button>
  </div>

  <!-- Formulario para crear un nuevo desafÃ­o -->
  <form (submit)="crearDesafio()" class="formulario-desafio">
    <label>
      Nombre del DesafÃ­o:
      <input
        type="text"
        [(ngModel)]="nuevoDesafio.nombre_desafio"
        name="nombre_desafio"
        required
        [disabled]="guardando"
      />
    </label>

    <label>
      DescripciÃ³n:
      <textarea
        [(ngModel)]="nuevoDesafio.descripcion"
        name="descripcion"
        required
        [disabled]="guardando"
      ></textarea>
    </label>

    <label>
      Recompensa (puntos):
      <input
        type="number"
        [(ngModel)]="nuevoDesafio.recompensa"
        name="recompensa"
        min="0"
        required
        [disabled]="guardando"
      />
    </label>

    <label>
      Dificultad:
      <select [(ngModel)]="nuevoDesafio.dificultad" name="dificultad" [disabled]="guardando">
        <option value="facil">FÃ¡cil</option>
        <option value="intermedio">Intermedio</option>
        <option value="dificil">DifÃ­cil</option>
      </select>
    </label>

    <label>
      Activo:
      <input
        type="checkbox"
        [(ngModel)]="nuevoDesafio.activo"
        name="activo"
        [disabled]="guardando"
      />
    </label>

    <button type="submit" [disabled]="guardando">
      {{ guardando ? 'Guardando...' : 'Agregar desafÃ­o' }}
    </button>
  </form>

  <!-- TÃ­tulo de la lista de desafÃ­os -->
  <h2>Lista de desafÃ­os creados</h2>

  <!-- Indicador de carga -->
  <div *ngIf="cargandoDesafios" class="mensaje-carga">ğŸ”„ Cargando desafÃ­os...</div>

  <!-- Mensaje de error -->
  <div *ngIf="errorCarga" class="mensaje-error">âš ï¸ {{ errorCarga }}</div>

  <!-- Tabla que lista todos los desafÃ­os creados -->
  <table class="tabla-desafios" *ngIf="!cargandoDesafios">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>DescripciÃ³n</th>
        <th>Recompensa</th>
        <th>Dificultad</th>
        <th>Activo</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let desafio of desafios">
        <td>{{ desafio.nombre_desafio }}</td>
        <td>{{ desafio.descripcion }}</td>
        <td>{{ desafio.recompensa }} pts</td>
        <td>{{ desafio.dificultad }}</td>
        <td>{{ desafio.activo ? 'âœ…' : 'âŒ' }}</td>
        <td>
          <button (click)="editarDesafio(desafio)" [disabled]="guardando || eliminando">âœï¸</button>
          <button (click)="eliminarDesafio(desafio)" [disabled]="guardando || eliminando">
            ğŸ—‘ï¸
          </button>
        </td>
      </tr>
      <tr *ngIf="desafios.length === 0 && !cargandoDesafios">
        <td colspan="6" style="text-align: center; color: #666">No hay desafÃ­os disponibles</td>
      </tr>
    </tbody>
  </table>

  <!-- Modal para editar un desafÃ­o existente -->
  <div class="modal" *ngIf="desafioEditando">
    <div class="modal-contenido">
      <h3>Editar desafÃ­o</h3>

      <div class="campo">
        <label>Nombre del DesafÃ­o:</label>
        <input type="text" [(ngModel)]="desafioEditando.nombre_desafio" [disabled]="guardando" />
      </div>

      <div class="campo">
        <label>DescripciÃ³n:</label>
        <textarea [(ngModel)]="desafioEditando.descripcion" [disabled]="guardando"></textarea>
      </div>

      <div class="campo">
        <label>Recompensa (puntos):</label>
        <input
          type="number"
          [(ngModel)]="desafioEditando.recompensa"
          min="0"
          [disabled]="guardando"
        />
      </div>

      <div class="campo">
        <label>Dificultad:</label>
        <select [(ngModel)]="desafioEditando.dificultad" [disabled]="guardando">
          <option value="facil">FÃ¡cil</option>
          <option value="intermedio">Intermedio</option>
          <option value="dificil">DifÃ­cil</option>
        </select>
      </div>

      <label>
        <input type="checkbox" [(ngModel)]="desafioEditando.activo" [disabled]="guardando" />
        Activo
      </label>

      <div class="acciones-modal">
        <button (click)="guardarEdicion()" [disabled]="guardando">
          {{ guardando ? 'Guardando...' : 'Guardar' }}
        </button>
        <button (click)="cancelarEdicion()" [disabled]="guardando">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmaciÃ³n para eliminar -->
  <div class="modal" *ngIf="desafioEliminar">
    <div class="modal-contenido">
      <h3>Â¿Eliminar desafÃ­o?</h3>
      <p>Â¿EstÃ¡s segura de eliminar <strong>{{ desafioEliminar.nombre_desafio }}</strong>?</p>
      <div class="acciones-modal">
        <button (click)="confirmarEliminar()" [disabled]="eliminando">
          {{ eliminando ? 'Eliminando...' : 'SÃ­, eliminar' }}
        </button>
        <button (click)="cancelarEliminar()" [disabled]="eliminando">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Submodal con mensaje de confirmaciÃ³n general -->
  <div class="submodal" *ngIf="mensajeConfirmacion">
    <div class="submodal-contenido">
      <p>{{ mensajeConfirmacion }}</p>
      <button (click)="cerrarConfirmacion()">Cerrar</button>
    </div>
  </div>
</section>
